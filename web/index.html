<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>tiny-rl-go Playground</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <h1>tiny-rl-go</h1>
        <form id="controlForm">
          <details class="control-section" open>
            <summary>Training</summary>
            <div class="control-grid">
              <label class="slider-label">
                <span class="slider-title">Algorithm</span>
                <span class="slider-help">Learning strategy for the agent.</span>
                <select name="algorithm">
                  <option value="montecarlo" selected>Monte Carlo</option>
                  <option value="q-learning">Q-Learning</option>
                  <option value="sarsa">SARSA</option>
                </select>
              </label>
              <label class="slider-label">
                <span class="slider-title">Episodes</span>
                <span class="slider-help">Number of training episodes per run.</span>
                <div class="slider-row">
                  <input type="range" name="episodes" min="1" max="300" value="100" data-output-target="episodesOutput" />
                  <span class="slider-output" id="episodesOutput">100</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Seed</span>
                <span class="slider-help">Deterministic seed for reproducible runs.</span>
                <div class="slider-row">
                  <input type="range" name="seed" min="0" max="1000" value="7" data-output-target="seedOutput" />
                  <span class="slider-output" id="seedOutput">7</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Step Delay (ms)</span>
                <span class="slider-help">Playback delay between rendered steps.</span>
                <div class="slider-row">
                  <input type="range" name="stepDelayMs" min="0" max="100" step="5" value="60" data-output-target="delayOutput" />
                  <span class="slider-output" id="delayOutput">60</span>
                </div>
              </label>
            </div>
          </details>

          <details class="control-section" open>
            <summary>Learning Parameters</summary>
            <div class="control-grid">
              <label class="slider-label">
                <span class="slider-title">Epsilon</span>
                <span class="slider-help">Exploration rate (probability of random action).</span>
                <div class="slider-row">
                  <input type="range" name="epsilon" min="0" max="1" step="0.01" value="0.5" data-output-target="epsilonOutput" />
                  <span class="slider-output" id="epsilonOutput">0.50</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Alpha</span>
                <span class="slider-help">Learning rate for value/Q updates.</span>
                <div class="slider-row">
                  <input type="range" name="alpha" min="0" max="1" step="0.01" value="0.2" data-output-target="alphaOutput" />
                  <span class="slider-output" id="alphaOutput">0.20</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Gamma</span>
                <span class="slider-help">Discount factor for future rewards.</span>
                <div class="slider-row">
                  <input type="range" name="gamma" min="0" max="1" step="0.01" value="0.9" data-output-target="gammaOutput" />
                  <span class="slider-output" id="gammaOutput">0.90</span>
                </div>
              </label>
            </div>
          </details>

          <details class="control-section" open>
            <summary>Environment</summary>
            <div class="control-grid">
              <label class="slider-label">
                <span class="slider-title">Rows</span>
                <span class="slider-help">Number of grid rows.</span>
                <div class="slider-row">
                  <input type="range" name="rows" min="1" max="20" value="4" data-output-target="rowsOutput" />
                  <span class="slider-output" id="rowsOutput">4</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Columns</span>
                <span class="slider-help">Number of grid columns.</span>
                <div class="slider-row">
                  <input type="range" name="cols" min="1" max="20" value="4" data-output-target="colsOutput" />
                  <span class="slider-output" id="colsOutput">4</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Step Penalty</span>
                <span class="slider-help">Reward deducted each move (encourages shorter paths).</span>
                <div class="slider-row">
                  <input type="range" name="stepPenalty" min="0" max="0.1" step="0.005" value="0.02" data-output-target="penaltyOutput" />
                  <span class="slider-output" id="penaltyOutput">0.02</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Goal Count</span>
                <span class="slider-help">Number of goals auto-placed before training starts.</span>
                <div class="slider-row">
                  <input type="range" name="goalCount" min="0" max="10" step="1" value="2" data-output-target="goalCountOutput" />
                  <span class="slider-output" id="goalCountOutput">2</span>
                </div>
              </label>
              <label class="slider-label">
                <span class="slider-title">Goal Interval</span>
                <span class="slider-help">Episodes between goal reshuffles (0 keeps layout).</span>
                <div class="slider-row">
                  <input type="range" name="goalInterval" min="0" max="10" step="1" value="0" data-output-target="goalIntervalOutput" />
                  <span class="slider-output" id="goalIntervalOutput">0</span>
                </div>
              </label>
            </div>
          </details>

          <details class="control-section" open>
            <summary>Obstacles</summary>
            <div class="slider-help">Maintain walls and slip tiles.</div>
            <div class="obstacle-controls">
              <div>
                <strong>Walls</strong>
                <div class="obstacle-row">
                  <input type="number" id="wallRow" min="0" value="0" />
                  <input type="number" id="wallCol" min="0" value="0" />
                  <button type="button" id="addWallBtn">Add Wall</button>
                </div>
                <ul id="wallList" class="obstacle-list"></ul>
              </div>
              <div>
                <strong>Slip Tiles</strong>
                <div class="obstacle-row">
                  <input type="number" id="slipRow" min="0" value="0" />
                  <input type="number" id="slipCol" min="0" value="0" />
                  <input type="number" id="slipProb" min="0" max="1" step="0.05" value="0.5" />
                  <button type="button" id="addSlipBtn">Add Slip</button>
                </div>
                <ul id="slipList" class="obstacle-list"></ul>
              </div>
            </div>
          </details>
          <div class="buttons">
            <button type="submit">Start Training</button>
            <button type="button" id="stopBtn">Stop</button>
          </div>
        </form>
        <div class="status" id="status"></div>
      </aside>
      <main class="main">
        <div class="canvas-toolbar">
          <div class="obstacle-toolbar" id="obstacleToolbar">
            <button type="button" data-tool="none" class="tool-button active">Navigate</button>
            <button type="button" data-tool="wall" class="tool-button">Place Wall</button>
            <button type="button" data-tool="slip" class="tool-button">Place Slip</button>
            <button type="button" data-tool="erase" class="tool-button">Erase</button>
            <label class="slip-probability" id="slipProbLabel">Slip p
              <input type="range" id="slipProbSlider" min="0" max="1" step="0.05" value="0.5" />
              <span id="slipProbValue">0.50</span>
            </label>
          </div>
          <div class="view-toggle">
            <button type="button" data-view="path" class="active">Path</button>
            <button type="button" data-view="heatmap">Heatmap</button>
          </div>
        </div>
        <div class="canvas-container" id="canvasContainer">
          <canvas id="gridCanvas" width="400" height="400"></canvas>
          <div class="resize-handle" id="resizeHandle"></div>
        </div>
        <p class="canvas-instructions">Use the toolbar (shortcuts: N navigate, W wall, S slip, E erase) and drag the corner to resize the grid.</p>
      </main>
      <section class="metrics" id="metrics">
        <h2>Metrics</h2>
        <div id="metricSummary">Episode and reward stats will appear here.</div>
        <h2>Event Log</h2>
        <div id="eventLog"></div>
      </section>
    </div>
    <script src="wasm_exec.js"></script>
    <script type="module" src="main.js"></script>
  </body>
</html>
